<!-- 
/*
 *	This content is generated from the PSD File Info.
 *	(Alt+Shift+Ctrl+I).
 *
 *	@desc 		
 *	@file 		gain_web_app
 *	@date 		1633033204595
 *	@title 		Page 1
 *	@author 	
 *	@keywords 	
 *	@generator 	Export Kit v1.3.figma
 *
*/
 -->
<!DOCTYPE html>
<html>
	<head>
		{% load static %}
		<meta http-equiv="content-type" content="text/html" charset="utf-8" />
		<title>Dashboard</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="" >
		<link rel="stylesheet" href="{% static 'css/dashboard.css' %}" >
		<script src="https://secure.exportkit.com/cdn/js/ek_googlefonts.js?v=4"></script>
		 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<!-- Add your custom HEAD content here -->

	</head>
	<body>
		<div id="content-container" >

				<div id="_bg__mainpage_ek2"  ></div>
				<header class='header'>
						<div class='header_logo' >
						    <img src="{% static 'media/image/logo.png' %}" alt="home"/>
					    </div>
						<div class='header_input' >
							<input class='input1' type="search" >
						</div>
						<button class="profile">
						</button>
					
				</header>
				
		</div>

		<div class='row'>
			<div class='main_column'>
				<!--index logo-->
				<img class='index_logo' src="{% static 'media/image/index.png' %}" />
				<div class='index'>
					<div class='nifty'>
						<p class='nifty_text'>NIFTY 50</p>
						<pre id='nifty_price' style="font-size: large;"></pre>
					</div>
					<div class='niftyBank'>
						<p class='niftyBank_text'>NIFTY BANK</p>
						<pre id='niftyBank_price' style="font-size: large;"></pre>
					</div>
				</div>
				<!--top gainer logo-->
				<img class='topgainer_logo' src="{% static 'media/image/topgainer.png' %}" />
				<div id='gainer' >
					<div >

					</div>
					<div>

					</div>
					<div>

					</div>
					<div>

					</div>
					<div>

					</div>
				</div>

				<!--top loser logo-->
				<img class='toploser_logo' src="{% static 'media/image/toploser.png' %}" />
				<div id='loser' >
					<div >

					</div>
					<div>

					</div>
					<div>

					</div>
					<div>

					</div>
					<div>
						
					</div>
				</div>

			</div>
			<div class='side_column' style=" margin-top: 2%;">
				<img class='investment_logo' src="{% static 'media/image/investment.png' %}" />
				<div class='investment' style="height: 600px;">

				</div>
			</div>
		</div>

	</body>

	<script>
		window.onload = refresh_function()

		function refresh_function() {
			fetchdata()
		}

		function fetchdata() {
			$.ajax({
				url : "{% url 'dashboard' %}",
				type : "POST",
				data : {
					'action' : 'dashboard_data',
					csrfmiddlewaretoken: '{{ csrf_token }}' ,

				},

				success : function(response){
					update_index(response['niftyPrice'], response['niftyBankPrice'],
					             response['niftyChange'], response['niftyPChange'],
								 response['niftyBankChange'], response['niftyBankPChange'] )
					//alert(response['niftyPrice']+' '+response['niftyBankPrice']);
					update_gainers(response['topGainers'], response['logos'])
					update_losers(response['topLosers'], response['logos'])
				    
				},
			});
		}

		function update_losers(topLosers, logos) {
			loser = document.getElementById('loser');
			loser.innerHTML = ''

			for(let i=0;i<topLosers.length;i++) {
				console.log(topLosers[i]);

				var div  = document.createElement('div');
				var symbol = topLosers[i]['symbol'];
				div.className = topLosers[i]['symbol'];
				var p = document.createElement('p');
				p.innerText = topLosers[i]['symbol'];

				var logo = document.createElement('img');
				logo.src = 'https://assets-netstorage.groww.in/stock-assets/logos/'+logos[topLosers[i]['symbol']]+'.png';

				div.appendChild(p);
				div.appendChild(logo);
				loser.appendChild(div);
			}
		}

		function update_gainers(topGainers, logos) {
			gainer = document.getElementById('gainer');
			gainer.innerHTML=''

			for(let i=0;i<topGainers.length;i++) {
				console.log(topGainers[i]);

				var div  = document.createElement('div');
				div.className = topGainers[i]['symbol'];
				var p = document.createElement('p');
				p.innerText = topGainers[i]['symbol'];
				div.appendChild(p);
				gainer.appendChild(div);
			}
		}

		function update_index(niftyPrice, niftyBankPrice, niftyChange, niftyPChange, niftyBankChange, niftyBankPChange){
			nifty_price = document.getElementById('nifty_price');
			niftyBank_price = document.getElementById('niftyBank_price');
            
			if(niftyChange >=0){
				nifty_price.innerHTML = '<font color="">'+niftyPrice+'</font>'+'  +'+niftyChange+'  +'+niftyPChange+'%';
			}
			else{
				nifty_price.innerHTML = niftyPrice+'  -'+niftyChange+'  -'+niftyPChange+'%';
			}

			if(niftyBankChange >=0){
				niftyBank_price.innerHTML = niftyBankPrice+'  +'+niftyBankChange+'  +'+niftyBankPChange+'%';
			}
			else{
				niftyBank_price.innerHTML = niftyBankPrice+'  -'+niftyBankChange+'  -'+niftyBankPChange+'%';
			}
			
		}

		$(document).ready(function(){
			setInterval(fetchdata,60000);
		})

	</script>
</html>